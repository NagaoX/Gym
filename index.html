<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gym - Seu Treino</title>
    
    <!-- React & ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- Babel for JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Mobile Drag and Drop Polyfill -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/default.css">
    <script src="https://cdn.jsdelivr.net/npm/mobile-drag-drop@2.3.0-rc.2/index.min.js"></script>
    
    <!-- Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                    animation: {
                        'bounce-short': 'bounce 1s infinite 2',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'slide-up': 'slideUp 0.4s ease-out',
                    },
                    keyframes: {
                        fadeIn: {
                            '0%': { opacity: '0' },
                            '100%': { opacity: '1' },
                        },
                        slideUp: {
                            '0%': { transform: 'translateY(20px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' },
                        }
                    }
                }
            }
        }
        
        // Initialize Polyfill for Mobile Drag & Drop
        var iOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
        if (typeof MobileDragDrop !== 'undefined') {
            MobileDragDrop.polyfill({
                dragImageTranslateOverride: MobileDragDrop.scrollBehaviourDragImageTranslateOverride,
                holdToDrag: iOS ? 100 : 50
            });
        }
    </script>
    
    <style>
        /* Custom Scrollbar hide */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }
        /* Hide number input arrows */
        input[type=number]::-webkit-inner-spin-button, 
        input[type=number]::-webkit-outer-spin-button { 
            -webkit-appearance: none; 
            margin: 0; 
        }
        /* Prevent selection during drag */
        .noselect {
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }
        /* Fix drag preview on mobile */
        .dnd-poly-drag-image {
            opacity: 0.5 !important;
            background: white;
            border-radius: 12px;
            box-shadow: 0 10px 20px rgba(0,0,0,0.19), 0 6px 6px rgba(0,0,0,0.23);
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 font-sans selection:bg-black selection:text-white">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo, useRef } = React;

        // --- HELPER: DETECT CARDIO ---
        const isCardioExercise = (name) => {
            if (!name) return false;
            const n = name.toLowerCase();
            return n.includes('(cardio)') || n.includes('eliptico') || n.includes('remo indoor') || n.includes('esteira') || n.includes('bike');
        };

        // --- HELPER: NORMALIZE FILENAME ---
        const getFileName = (name) => {
            if (!name) return "";
            return "imagens/" + name.toLowerCase()
                .split('(')[0] 
                .trim()
                .normalize("NFD").replace(/[\u0300-\u036f]/g, "") 
                .replace(/ \/ /g, '_') 
                .replace(/ /g, '_') 
                .replace(/[^a-z0-9_]/g, '') 
                + ".gif";
        };

        // --- LISTA DE EXERCÍCIOS BÁSICOS ---
        const BASIC_EXERCISES_LIST = [
            "Abdominal Infra", "Abdominal Supra", "Agachamento Livre", "Agachamento Smith", "Avanço / Afundo",
            "Bike (Cardio)", "Cadeira Abdutora", "Cadeira Extensora", "Crucifixo", "Desenvolvimento Halteres", 
            "Elevação Frontal", "Elevação Lateral", "Elevação Pélvica", "Eliptico (Cardio)", "Encolhimento",
            "Esteira (Cardio)", "Graviton", "Leg Press 45°", "Mesa Flexora", "Panturrilha",
            "Peck Deck / Voador", "Prancha", "Puxada Alta / Frente", "Remada Baixa", "Remada Curvada", 
            "Remo Indoor (Cardio)", "Rosca Direta", "Rosca Martelo", "Rosca Scott", "Stiff", 
            "Supino Inclinado (Halter)", "Supino Reto (Barra)", "Tríceps Corda", "Tríceps Francês", 
            "Tríceps Pulley", "Tríceps Testa"
        ].sort(); 

        // --- MODELOS DE TREINO ---
        const WORKOUT_TEMPLATES = {
            female: {
                beginner: {
                    A: [
                        { id: 'fa1', name: "Agachamento Livre (Halter)", reps: "3 x 12", rest: "60", load: "0", img: "imagens/agachamento_livre.gif" },
                        { id: 'fa2', name: "Leg Press 45°", reps: "3 x 12", rest: "60", load: "20", img: "imagens/leg_press_45.gif" },
                        { id: 'fa3', name: "Supino Máquina", reps: "3 x 12", rest: "60", load: "10", img: "imagens/supino_maquina.gif" },
                        { id: 'fa4', name: "Puxada Frente", reps: "3 x 12", rest: "60", load: "15", img: "imagens/puxada_frente.gif" },
                        { id: 'fa5', name: "Abdominal Supra", reps: "3 x 15", rest: "45", load: "0", img: "imagens/abdominal_supra.gif" }
                    ],
                    B: [
                        { id: 'fb1', name: "Avanço / Afundo", reps: "3 x 10", rest: "60", load: "0", img: "imagens/avanco_smith.gif" },
                        { id: 'fb2', name: "Mesa Flexora", reps: "3 x 12", rest: "60", load: "15", img: "imagens/flexora.gif" },
                        { id: 'fb3', name: "Desenvolvimento Halter", reps: "3 x 10", rest: "60", load: "4", img: "imagens/desenvolvimento_halter.gif" },
                        { id: 'fb4', name: "Rosca Direta", reps: "3 x 12", rest: "45", load: "5", img: "imagens/rosca_direta.gif" },
                        { id: 'fb5', name: "Tríceps Pulley", reps: "3 x 12", rest: "45", load: "10", img: "imagens/triceps_pulley.gif" }
                    ]
                },
                intermediate: {
                    A: [
                        { id: 'a1', name: "Agachamento Smith", reps: "4 x 10", rest: "90", load: "20", img: "imagens/agachamento_smith.gif" },
                        { id: 'a2', name: "Leg Press 45°", reps: "3 x 12", rest: "60", load: "70", img: "imagens/leg_press_45.gif" },
                        { id: 'a3', name: "Avanço / Afundo", reps: "3 x 10", rest: "60", load: "10", img: "imagens/avanco_smith.gif" },
                        { id: 'a4', name: "Cadeira Extensora", reps: "3 x 15", rest: "45", load: "25", img: "imagens/cadeira_extensora.gif" },
                        { id: 'a5', name: "Panturrilha", reps: "4 x 15", rest: "45", load: "30", img: "imagens/panturrilha_smith.gif" },
                        { id: 'a6', name: "Abdominal Supra", reps: "4 x 20", rest: "30", load: "0", img: "imagens/abdominal_supra.gif" }
                    ],
                    B: [
                        { id: 'b1', name: "Desenvolvimento Máq.", reps: "3 x 12", rest: "60", load: "10", img: "imagens/desenvolvimento_maquina.gif" },
                        { id: 'b2', name: "Elevação Lateral", reps: "4 x 12", rest: "45", load: "4", img: "imagens/elevacao_lateral.gif" },
                        { id: 'b3', name: "Tríceps Corda", reps: "3 x 12", rest: "45", load: "15", img: "imagens/triceps_corda.gif" },
                        { id: 'b4', name: "Tríceps Francês", reps: "3 x 12", rest: "45", load: "5", img: "imagens/triceps_frances.gif" },
                        { id: 'b5', name: "Abdominal Infra", reps: "4 x 15", rest: "30", load: "0", img: "imagens/abdominal_infra.gif" }
                    ],
                    C: [
                        { id: 'c1', name: "Elevação Pélvica", reps: "4 x 12", rest: "90", load: "40", img: "imagens/elevacao_pelvica.gif" },
                        { id: 'c2', name: "Stiff", reps: "4 x 10", rest: "60", load: "30", img: "imagens/stiff.gif" },
                        { id: 'c3', name: "Mesa Flexora", reps: "3 x 12", rest: "60", load: "30", img: "imagens/flexora.gif" },
                        { id: 'c4', name: "Cadeira Abdutora", reps: "3 x 15", rest: "45", load: "60", img: "imagens/cadeira_abdutora.gif" },
                        { id: 'c5', name: "Agachamento Sumô", reps: "3 x 12", rest: "60", load: "16", img: "imagens/agachamento_sumo.gif" },
                        { id: 'c6', name: "Prancha", reps: "4 x 45", rest: "30", load: "0", img: "imagens/prancha.gif" }
                    ],
                    D: [
                        { id: 'd1', name: "Graviton", reps: "3 x 10", rest: "60", load: "40", img: "imagens/graviton.gif" },
                        { id: 'd2', name: "Puxada Frente", reps: "3 x 12", rest: "60", load: "25", img: "imagens/puxada_frente.gif" },
                        { id: 'd3', name: "Supino Máquina", reps: "3 x 12", rest: "60", load: "15", img: "imagens/supino_maquina.gif" },
                        { id: 'd4', name: "Remada Baixa", reps: "3 x 12", rest: "60", load: "25", img: "imagens/remada_baixa.gif" },
                        { id: 'd5', name: "Rosca Halter", reps: "3 x 12", rest: "45", load: "5", img: "imagens/rosca_halter.gif" },
                        { id: 'd6', name: "Abdominal Remador", reps: "4 x 15", rest: "30", load: "0", img: "imagens/abdominal_remador.gif" }
                    ]
                },
                advanced: {
                    A: [
                        { id: 'aa1', name: "Elevação Pélvica", reps: "4 x 10", rest: "90", load: "80", img: "imagens/elevacao_pelvica.gif" },
                        { id: 'aa2', name: "Stiff", reps: "4 x 10", rest: "90", load: "50", img: "imagens/stiff.gif" },
                        { id: 'aa3', name: "Mesa Flexora", reps: "3 x 12", rest: "60", load: "40", img: "imagens/flexora.gif" },
                        { id: 'aa4', name: "Cadeira Abdutora", reps: "3 x 20", rest: "45", load: "70", img: "imagens/cadeira_abdutora.gif" }
                    ],
                    B: [
                        { id: 'ab1', name: "Puxada Frente", reps: "4 x 10", rest: "60", load: "40", img: "imagens/puxada_frente.gif" },
                        { id: 'ab2', name: "Remada Curvada", reps: "3 x 12", rest: "60", load: "30", img: "imagens/remada_curvada.gif" },
                        { id: 'ab3', name: "Desenvolvimento Halteres", reps: "3 x 10", rest: "60", load: "12", img: "imagens/desenvolvimento_halter.gif" },
                        { id: 'ab4', name: "Elevação Lateral", reps: "4 x 15", rest: "45", load: "6", img: "imagens/elevacao_lateral.gif" }
                    ],
                    C: [
                        { id: 'ac1', name: "Agachamento Livre", reps: "4 x 8", rest: "120", load: "50", img: "imagens/agachamento_livre.gif" },
                        { id: 'ac2', name: "Leg Press 45°", reps: "4 x 10", rest: "90", load: "120", img: "imagens/leg_press_45.gif" },
                        { id: 'ac3', name: "Cadeira Extensora", reps: "3 x 15", rest: "60", load: "40", img: "imagens/cadeira_extensora.gif" },
                        { id: 'ac4', name: "Panturrilha", reps: "4 x 15", rest: "45", load: "50", img: "imagens/panturrilha_smith.gif" }
                    ],
                    D: [
                        { id: 'ad1', name: "Esteira (Cardio)", reps: "20", rest: "0", load: "0", img: "" },
                        { id: 'ad2', name: "Prancha", reps: "4 x 1", rest: "60", load: "0", img: "imagens/prancha.gif" },
                        { id: 'ad3', name: "Abdominal Infra", reps: "4 x 15", rest: "45", load: "0", img: "imagens/abdominal_infra.gif" }
                    ]
                }
            },
            male: {
                beginner: {
                    A: [
                        { id: 'ma1', name: "Supino Reto (Barra)", reps: "3 x 12", rest: "60", load: "15", img: "imagens/supino_reto.gif" },
                        { id: 'ma2', name: "Puxada Frente", reps: "3 x 12", rest: "60", load: "20", img: "imagens/puxada_frente.gif" },
                        { id: 'ma3', name: "Desenvolvimento Máq", reps: "3 x 12", rest: "60", load: "10", img: "imagens/desenvolvimento_maquina.gif" },
                        { id: 'ma4', name: "Rosca Direta", reps: "3 x 12", rest: "45", load: "5", img: "imagens/rosca_direta.gif" },
                        { id: 'ma5', name: "Tríceps Pulley", reps: "3 x 12", rest: "45", load: "15", img: "imagens/triceps_pulley.gif" }
                    ],
                    B: [
                        { id: 'mb1', name: "Leg Press 45°", reps: "3 x 12", rest: "60", load: "40", img: "imagens/leg_press_45.gif" },
                        { id: 'mb2', name: "Cadeira Extensora", reps: "3 x 12", rest: "60", load: "20", img: "imagens/cadeira_extensora.gif" },
                        { id: 'mb3', name: "Mesa Flexora", reps: "3 x 12", rest: "60", load: "20", img: "imagens/flexora.gif" },
                        { id: 'mb4', name: "Panturrilha", reps: "3 x 15", rest: "45", load: "20", img: "imagens/panturrilha_smith.gif" },
                        { id: 'mb5', name: "Abdominal Supra", reps: "3 x 20", rest: "45", load: "0", img: "imagens/abdominal_supra.gif" }
                    ]
                },
                intermediate: {
                    A: [
                        { id: 'mia1', name: "Supino Reto (Barra)", reps: "4 x 10", rest: "90", load: "30", img: "imagens/supino_reto.gif" },
                        { id: 'mia2', name: "Supino Inclinado (Halter)", reps: "3 x 10", rest: "60", load: "14", img: "imagens/supino_inclinado.gif" },
                        { id: 'mia3', name: "Desenvolvimento Halteres", reps: "3 x 10", rest: "60", load: "12", img: "imagens/desenvolvimento_halter.gif" },
                        { id: 'mia4', name: "Elevação Lateral", reps: "4 x 12", rest: "45", load: "8", img: "imagens/elevacao_lateral.gif" },
                        { id: 'mia5', name: "Tríceps Corda", reps: "3 x 12", rest: "45", load: "20", img: "imagens/triceps_corda.gif" }
                    ],
                    B: [
                        { id: 'mib1', name: "Puxada Frente", reps: "4 x 10", rest: "60", load: "40", img: "imagens/puxada_frente.gif" },
                        { id: 'mib2', name: "Remada Baixa", reps: "3 x 12", rest: "60", load: "35", img: "imagens/remada_baixa.gif" },
                        { id: 'mib3', name: "Remada Curvada", reps: "3 x 10", rest: "90", load: "30", img: "imagens/remada_curvada.gif" },
                        { id: 'mib4', name: "Rosca Direta", reps: "3 x 10", rest: "45", load: "10", img: "imagens/rosca_direta.gif" },
                        { id: 'mib5', name: "Rosca Martelo", reps: "3 x 12", rest: "45", load: "10", img: "imagens/rosca_martelo.gif" }
                    ],
                    C: [
                        { id: 'mic1', name: "Agachamento Livre", reps: "4 x 8", rest: "120", load: "40", img: "imagens/agachamento_livre.gif" },
                        { id: 'mic2', name: "Leg Press 45°", reps: "4 x 10", rest: "90", load: "100", img: "imagens/leg_press_45.gif" },
                        { id: 'mic3', name: "Cadeira Extensora", reps: "3 x 12", rest: "60", load: "40", img: "imagens/cadeira_extensora.gif" },
                        { id: 'mic4', name: "Mesa Flexora", reps: "3 x 12", rest: "60", load: "30", img: "imagens/flexora.gif" },
                        { id: 'mic5', name: "Panturrilha", reps: "4 x 15", rest: "45", load: "40", img: "imagens/panturrilha_smith.gif" }
                    ]
                },
                advanced: {
                    A: [
                        { id: 'maa1', name: "Supino Reto (Barra)", reps: "4 x 8", rest: "120", load: "60", img: "imagens/supino_reto.gif" },
                        { id: 'maa2', name: "Supino Inclinado (Halter)", reps: "3 x 8", rest: "90", load: "24", img: "imagens/supino_inclinado.gif" },
                        { id: 'maa3', name: "Peck Deck / Voador", reps: "3 x 12", rest: "60", load: "50", img: "imagens/peck_deck.gif" },
                        { id: 'maa4', name: "Tríceps Testa", reps: "3 x 10", rest: "60", load: "10", img: "imagens/triceps_testa.gif" },
                        { id: 'maa5', name: "Tríceps Corda", reps: "3 x 12", rest: "45", load: "25", img: "imagens/triceps_corda.gif" }
                    ],
                    B: [
                        { id: 'mab1', name: "Graviton", reps: "4 x 10", rest: "90", load: "0", img: "imagens/graviton.gif" },
                        { id: 'mab2', name: "Remada Curvada", reps: "4 x 8", rest: "90", load: "50", img: "imagens/remada_curvada.gif" },
                        { id: 'mab3', name: "Puxada Frente", reps: "3 x 10", rest: "60", load: "50", img: "imagens/puxada_frente.gif" },
                        { id: 'mab4', name: "Rosca Direta", reps: "3 x 10", rest: "60", load: "15", img: "imagens/rosca_direta.gif" },
                        { id: 'mab5', name: "Rosca Scott", reps: "3 x 12", rest: "45", load: "12", img: "imagens/rosca_scott.gif" }
                    ],
                    C: [
                        { id: 'mac1', name: "Agachamento Livre", reps: "4 x 6", rest: "180", load: "80", img: "imagens/agachamento_livre.gif" },
                        { id: 'mac2', name: "Leg Press 45°", reps: "4 x 10", rest: "120", load: "180", img: "imagens/leg_press_45.gif" },
                        { id: 'mac3', name: "Stiff", reps: "3 x 10", rest: "90", load: "60", img: "imagens/stiff.gif" },
                        { id: 'mac4', name: "Cadeira Extensora", reps: "3 x 15", rest: "60", load: "50", img: "imagens/cadeira_extensora.gif" },
                        { id: 'mac5', name: "Panturrilha", reps: "5 x 15", rest: "45", load: "60", img: "imagens/panturrilha_smith.gif" }
                    ],
                    D: [
                        { id: 'mad1', name: "Desenvolvimento Halteres", reps: "4 x 8", rest: "90", load: "20", img: "imagens/desenvolvimento_halter.gif" },
                        { id: 'mad2', name: "Elevação Lateral", reps: "4 x 12", rest: "45", load: "10", img: "imagens/elevacao_lateral.gif" },
                        { id: 'mad3', name: "Elevação Frontal", reps: "3 x 12", rest: "45", load: "10", img: "imagens/elevacao_frontal.gif" },
                        { id: 'mad4', name: "Encolhimento", reps: "4 x 15", rest: "45", load: "24", img: "imagens/encolhimento.gif" }
                    ]
                }
            }
        };

        const IconBase = ({ children, size = 24, color = "currentColor", strokeWidth = 2, className = "", ...props }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke={color} strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className} {...props}>
                {children}
            </svg>
        );

        const CheckCircle = (props) => <IconBase {...props}><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14" /><polyline points="22 4 12 14.01 9 11.01" /></IconBase>;
        const Calendar = (props) => <IconBase {...props}><rect x="3" y="4" width="18" height="18" rx="2" ry="2" /><line x1="16" y1="2" x2="16" y2="6" /><line x1="8" y1="2" x2="8" y2="6" /><line x1="3" y1="10" x2="21" y2="10" /></IconBase>;
        const Plus = (props) => <IconBase {...props}><line x1="12" y1="5" x2="12" y2="19" /><line x1="5" y1="12" x2="19" y2="12" /></IconBase>;
        const User = (props) => <IconBase {...props}><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" /><circle cx="12" cy="7" r="4" /></IconBase>;
        const Settings = (props) => <IconBase {...props}><circle cx="12" cy="12" r="3" /><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" /></IconBase>;
        const Edit2 = (props) => <IconBase {...props}><path d="M17 3a2.828 2.828 0 1 1 4 4L7.5 20.5 2 22l1.5-5.5L17 3z" /></IconBase>;
        const X = (props) => <IconBase {...props}><line x1="18" y1="6" x2="6" y2="18" /><line x1="6" y1="6" x2="18" y2="18" /></IconBase>;
        const Check = (props) => <IconBase {...props}><polyline points="20 6 9 17 4 12" /></IconBase>;
        const ChevronLeft = (props) => <IconBase {...props}><polyline points="15 18 9 12 15 6" /></IconBase>;
        const Dumbbell = (props) => <IconBase {...props}><path d="m6.5 6.5 11 11" /><path d="m21 21-1-1" /><path d="m3 3 1 1" /><path d="m18 22 4-4" /><path d="m2 6 4-4" /><path d="m3 10 7-7" /><path d="m14 21 7-7" /></IconBase>;
        const Trophy = (props) => <IconBase {...props}><path d="M8 21h8" /><path d="M12 17v4" /><path d="M7 4h10" /><path d="M17 4v6a5 5 0 1 1-10 0V4" /><path d="M5 9v1a10 10 0 0 0 10 10" /><path d="M19 9v1a10 10 0 0 1-10 10" /></IconBase>;
        const ArrowRight = (props) => <IconBase {...props}><line x1="5" y1="12" x2="19" y2="12" /><polyline points="12 5 19 12 12 19" /></IconBase>;
        const Trash2 = (props) => <IconBase {...props}><polyline points="3 6 5 6 21 6" /><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2" /><line x1="10" y1="11" x2="10" y2="17" /><line x1="14" y1="11" x2="14" y2="17" /></IconBase>;
        const MoreHorizontal = (props) => <IconBase {...props}><circle cx="12" cy="12" r="1" /><circle cx="19" cy="12" r="1" /><circle cx="5" cy="12" r="1" /></IconBase>;
        const AlertTriangle = (props) => <IconBase {...props}><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z" /><line x1="12" y1="9" x2="12" y2="13" /><line x1="12" y1="17" x2="12.01" y2="17" /></IconBase>;
        const GripVertical = (props) => <IconBase {...props}><circle cx="9" cy="12" r="1" /><circle cx="9" cy="5" r="1" /><circle cx="9" cy="19" r="1" /><circle cx="15" cy="12" r="1" /><circle cx="15" cy="5" r="1" /><circle cx="15" cy="19" r="1" /></IconBase>;
        const ChevronUp = (props) => <IconBase {...props}><polyline points="18 15 12 9 6 15" /></IconBase>;
        const ChevronDown = (props) => <IconBase {...props}><polyline points="6 9 12 15 18 9" /></IconBase>;

        // --- COMPONENTE: SWITCH (IOS STYLE) ---
        const Switch = ({ enabled, setEnabled }) => (
            <button
                onClick={(e) => { e.stopPropagation(); setEnabled(!enabled); }}
                className={`${enabled ? 'bg-green-500' : 'bg-gray-200'} relative inline-flex h-6 w-11 items-center rounded-full transition-colors duration-200 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500`}
            >
                <span className={`${enabled ? 'translate-x-6' : 'translate-x-1'} inline-block h-4 w-4 transform rounded-full bg-white transition duration-200 shadow-sm`} />
            </button>
        );

        // --- COMPONENTE: DRAGGABLE ITEM (SWIPE TO DELETE + DRAG) ---
        const DraggableListItem = ({ children, onDelete, onDragStart, onDragOver, onDrop, onMoveUp, onMoveDown, index, totalItems }) => {
            const [offsetX, setOffsetX] = useState(0);
            const [startX, setStartX] = useState(0);
            const [isSwiping, setIsSwiping] = useState(false);

            const onTouchStart = (e) => {
                // Ignore swipe logic if touching the drag handle (right side) or control buttons
                // Simply checking if target is the grip or chevron buttons
                if (e.target.closest('.drag-controls')) return;

                const touchX = e.touches[0].clientX;
                setStartX(touchX);
                setIsSwiping(true);
            };

            const onTouchMove = (e) => {
                if (!isSwiping) return;
                const currentX = e.touches[0].clientX;
                const diff = currentX - startX;
                // Permitir apenas deslizar para a esquerda (negativo)
                if (diff < 0 && diff > -100) {
                    setOffsetX(diff);
                } else if (diff > 0) {
                    setOffsetX(0); // Restore on right swipe
                }
            };

            const onTouchEnd = () => {
                setIsSwiping(false);
                if (offsetX < -40) {
                    setOffsetX(-80);
                } else {
                    setOffsetX(0);
                }
            };

            return (
                <div 
                    className="relative overflow-hidden mb-3 rounded-2xl transition-all"
                    draggable
                    onDragStart={(e) => onDragStart(e, index)}
                    onDragOver={(e) => onDragOver(e, index)}
                    onDrop={(e) => onDrop(e, index)}
                >
                    {/* Background (Lixeira) */}
                    <div className="absolute inset-0 bg-red-500 flex items-center justify-end pr-4 rounded-2xl">
                        <button onClick={onDelete} className="text-white flex flex-col items-center justify-center">
                            <Trash2 size={24} />
                            <span className="text-[10px] font-bold uppercase mt-1">Excluir</span>
                        </button>
                    </div>

                    {/* Foreground (Conteúdo) */}
                    <div
                        className="bg-white relative z-10 transition-transform duration-200 ease-out"
                        style={{ transform: `translateX(${offsetX}px)` }}
                        onTouchStart={onTouchStart}
                        onTouchMove={onTouchMove}
                        onTouchEnd={onTouchEnd}
                    >
                        <div className="p-4 flex items-center justify-between">
                            {/* Left side content passed as children */}
                            <div className="flex-1">
                                {children}
                            </div>

                            {/* Right side controls: Move Up/Down and Grip */}
                            <div className="flex items-center gap-1 drag-controls pl-2 border-l border-gray-100 ml-2">
                                <div className="flex flex-col gap-2">
                                    <button 
                                        onClick={(e) => { e.stopPropagation(); onMoveUp(index); }}
                                        disabled={index === 0}
                                        className={`p-1 rounded-md ${index === 0 ? 'text-gray-200' : 'text-gray-400 hover:bg-gray-100 hover:text-black'}`}
                                    >
                                        <ChevronUp size={16} />
                                    </button>
                                    <button 
                                        onClick={(e) => { e.stopPropagation(); onMoveDown(index); }}
                                        disabled={index === totalItems - 1}
                                        className={`p-1 rounded-md ${index === totalItems - 1 ? 'text-gray-200' : 'text-gray-400 hover:bg-gray-100 hover:text-black'}`}
                                    >
                                        <ChevronDown size={16} />
                                    </button>
                                </div>
                                <div className="text-gray-300 cursor-grab active:cursor-grabbing p-2 noselect">
                                    <GripVertical size={20} />
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };


        // --- COMPONENTE: CARD DE EXERCÍCIO ---
        const ExerciseCard = ({ exercise, isDone, onCheck, onEdit }) => {
            const [showImg, setShowImg] = useState(false);
            const isCardio = isCardioExercise(exercise.name);

            return (
                <div className={`bg-white rounded-[24px] p-5 mb-4 shadow-sm border transition-all duration-300 ${isDone ? 'border-green-400 bg-green-50/30' : 'border-gray-100'}`}>
                    <div className="flex items-start gap-4">
                        <button 
                            onClick={onCheck}
                            className={`mt-1 w-8 h-8 rounded-full border-2 flex items-center justify-center transition-all duration-300 shrink-0 ${isDone ? 'bg-green-500 border-green-500 text-white scale-110 shadow-md' : 'bg-transparent border-gray-300 hover:border-green-400 text-transparent'}`}
                        >
                            <Check size={18} strokeWidth={3} />
                        </button>
                        <div className="flex-1 min-w-0" onClick={() => !isDone && onCheck()}>
                            <h4 className={`font-bold text-gray-900 text-lg leading-tight transition-all ${isDone ? 'opacity-50 line-through decoration-2' : ''}`}>
                                {exercise.name}
                            </h4>
                            <div className={`flex flex-wrap items-center gap-2 mt-2 ${isDone ? 'opacity-50' : ''}`}>
                                <div className="bg-gray-100 px-3 py-1 rounded-lg text-xs font-bold text-gray-600 uppercase tracking-wide">
                                    {isCardio ? `${exercise.reps} min` : `${exercise.reps} Reps`}
                                </div>
                                <div className="bg-gray-100 px-3 py-1 rounded-lg text-xs font-bold text-gray-600 uppercase tracking-wide">
                                    {isCardio ? `Nível ${exercise.load}` : `${exercise.load} kg`}
                                </div>
                                {!isCardio && (
                                    <div className="bg-gray-100 px-3 py-1 rounded-lg text-xs font-bold text-gray-600 uppercase tracking-wide flex items-center gap-1">
                                        ⏱ {exercise.rest}s
                                    </div>
                                )}
                            </div>
                        </div>
                        {!isCardio && (
                            <div className="flex flex-col items-center gap-3 shrink-0">
                                <Switch enabled={showImg} setEnabled={setShowImg} />
                                <button 
                                    onClick={(e) => { e.stopPropagation(); onEdit(); }}
                                    className="p-2 text-gray-300 hover:text-black hover:bg-gray-100 rounded-full transition-colors"
                                >
                                    <Edit2 size={16} />
                                </button>
                            </div>
                        )}
                        {isCardio && (
                             <button 
                                onClick={(e) => { e.stopPropagation(); onEdit(); }}
                                className="p-2 text-gray-300 hover:text-black hover:bg-gray-100 rounded-full transition-colors self-center"
                            >
                                <Edit2 size={16} />
                            </button>
                        )}
                    </div>
                    {!isCardio && (
                        <div className={`transition-all duration-300 overflow-hidden ${showImg ? 'max-h-64 mt-4 opacity-100' : 'max-h-0 opacity-0'}`}>
                            <div className="rounded-2xl overflow-hidden aspect-video bg-gray-200 relative flex items-center justify-center">
                                <img 
                                    src={exercise.img} 
                                    alt={exercise.name} 
                                    className="w-full h-full object-cover" 
                                    onError={(e) => {
                                        e.target.style.display = 'none';
                                        e.target.parentElement.innerHTML = `<div class='flex flex-col items-center justify-center h-full w-full bg-gray-100 text-gray-400 text-xs text-center p-4'><span class='font-bold mb-1'>Foto não encontrada</span>Salvar como:<br/>${exercise.img}</div>`;
                                    }}
                                />
                                <div className="absolute inset-0 bg-gradient-to-t from-black/20 to-transparent pointer-events-none"></div>
                            </div>
                        </div>
                    )}
                </div>
            );
        };

        // --- APP PRINCIPAL ---
        const FlexLogApp = () => {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('loading'); 
            const [currentWorkout, setCurrentWorkout] = useState(null);
            const [completedExercises, setCompletedExercises] = useState([]);
            const [showFinishedModal, setShowFinishedModal] = useState(false);
            const [editingIndex, setEditingIndex] = useState(null);
            const [showAddModal, setShowAddModal] = useState(false);
            const [isCustomExercise, setIsCustomExercise] = useState(false);
            const [isCardioSelected, setIsCardioSelected] = useState(false); // State for Add Modal cardio check

            // Estados temporários para Edição
            const [editRepsSets, setEditRepsSets] = useState('');
            const [editRepsCount, setEditRepsCount] = useState('');
            const [tempWorkoutList, setTempWorkoutList] = useState([]); // Temporary list for edit mode

            // Novos estados para o cadastro
            const [newUserName, setNewUserName] = useState('');
            const [newUserGender, setNewUserGender] = useState('female');
            const [newUserLevel, setNewUserLevel] = useState('beginner');

            // Drag State
            const dragItem = useRef(null);
            const dragOverItem = useRef(null);

            useEffect(() => {
                const saved = localStorage.getItem('gym_user_v2'); 
                if (saved) {
                    setUser(JSON.parse(saved));
                    setView('dashboard');
                } else {
                    setView('disclaimer'); 
                }
            }, []);

            useEffect(() => {
                if (user) {
                    localStorage.setItem('gym_user_v2', JSON.stringify(user));
                }
            }, [user]);

            const getSuggestedWorkout = () => {
                if (!user?.workouts) return 'A';
                if (!user?.history || user.history.length === 0) return 'A';
                const last = user.history[user.history.length - 1].type;
                const types = Object.keys(user.workouts); 
                const nextIndex = (types.indexOf(last) + 1) % types.length;
                return types[nextIndex];
            };

            const suggested = useMemo(() => getSuggestedWorkout(), [user]);

            const getDaysRemaining = () => {
                if (!user?.history) return 60;
                return Math.max(0, 60 - user.history.length);
            };

            const handleLogin = () => {
                if (!newUserName) return;
                const selectedWorkouts = WORKOUT_TEMPLATES[newUserGender][newUserLevel];
                const newUser = {
                    name: newUserName,
                    gender: newUserGender,
                    level: newUserLevel,
                    workouts: selectedWorkouts, 
                    history: []
                };
                setUser(newUser);
                setView('dashboard');
            };

            const startWorkout = (type) => {
                setCurrentWorkout(type);
                setCompletedExercises([]);
                setView('workout');
            };

            const goToEditMode = (type) => {
                setCurrentWorkout(type);
                setTempWorkoutList([...user.workouts[type]]); // Initialize temp list
                setView('edit_workout');
            }

            const finishWorkout = () => {
                const today = new Date().toLocaleDateString('pt-BR');
                const newHistory = [...user.history, { date: today, type: currentWorkout }];
                setUser({ ...user, history: newHistory });
                setShowFinishedModal(true);
            };

            // Parse helpers
            const parseReps = (repsString) => {
                const parts = repsString.split('x').map(s => s.trim());
                if (parts.length >= 2) return { sets: parts[0], reps: parts[1] };
                return { sets: '3', reps: '12' }; // Default fallback
            };

            const openEditModal = (idx) => {
                setEditingIndex(idx);
                const currentEx = user.workouts[currentWorkout][idx];
                const cardio = isCardioExercise(currentEx.name);
                
                if (cardio) {
                    // For cardio, reps string is basically time
                    setEditRepsCount(currentEx.reps); // Store time in reps state for simplicity
                    setEditRepsSets(''); // No sets
                } else {
                    const { sets, reps } = parseReps(currentEx.reps);
                    setEditRepsSets(sets);
                    setEditRepsCount(reps);
                }
            };

            const saveEdit = (sets, reps, load, rest) => {
                const newWorkouts = { ...user.workouts };
                const isCardio = isCardioExercise(newWorkouts[currentWorkout][editingIndex].name);
                
                let formattedReps = '';
                if(isCardio) {
                    formattedReps = reps; // Just time
                } else {
                    formattedReps = `${sets} x ${reps}`;
                }

                newWorkouts[currentWorkout][editingIndex] = {
                    ...newWorkouts[currentWorkout][editingIndex],
                    reps: formattedReps,
                    load,
                    rest: isCardio ? '0' : rest
                };
                setUser({ ...user, workouts: newWorkouts });
                setEditingIndex(null);
            };

            const removeExerciseFromTemp = (indexToRemove) => {
                if(confirm("Tem certeza que deseja excluir este exercício?")){
                    const updatedList = tempWorkoutList.filter((_, idx) => idx !== indexToRemove);
                    setTempWorkoutList(updatedList);
                }
            };

            const addExerciseToTemp = (data) => {
                const isCardio = isCardioSelected; // Use state from Add Modal
                const formattedReps = isCardio ? data.reps : `${data.sets} x ${data.reps}`;
                
                const newExercise = {
                    id: Date.now().toString(),
                    name: data.name,
                    reps: formattedReps,
                    load: data.load,
                    rest: isCardio ? '0' : data.rest,
                    img: isCardio ? '' : (data.img || getFileName(data.name))
                };
                setTempWorkoutList([...tempWorkoutList, newExercise]);
                setShowAddModal(false);
                setIsCustomExercise(false); 
                setIsCardioSelected(false);
            };

            // Drag Functions for Temp List
            const onDragStart = (e, index) => {
                dragItem.current = index;
            };

            const onDragOver = (e, index) => {
                e.preventDefault();
                dragOverItem.current = index;
            };

            const onDropTemp = (e) => {
                const copyListItems = [...tempWorkoutList];
                const dragItemContent = copyListItems[dragItem.current];
                copyListItems.splice(dragItem.current, 1);
                copyListItems.splice(dragOverItem.current, 0, dragItemContent);
                dragItem.current = null;
                dragOverItem.current = null;
                setTempWorkoutList(copyListItems);
            };

            const moveUp = (index) => {
                if (index === 0) return;
                const copyList = [...tempWorkoutList];
                const item = copyList[index];
                copyList[index] = copyList[index - 1];
                copyList[index - 1] = item;
                setTempWorkoutList(copyList);
            };

            const moveDown = (index) => {
                if (index === tempWorkoutList.length - 1) return;
                const copyList = [...tempWorkoutList];
                const item = copyList[index];
                copyList[index] = copyList[index + 1];
                copyList[index + 1] = item;
                setTempWorkoutList(copyList);
            };

            const saveWorkoutChanges = () => {
                setUser({
                    ...user,
                    workouts: {
                        ...user.workouts,
                        [currentWorkout]: tempWorkoutList
                    }
                });
                setView('dashboard');
            };

            const cancelWorkoutChanges = () => {
                setView('dashboard');
            }

            // Views
            if (view === 'loading') return null;

            if (view === 'disclaimer') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-white animate-fade-in relative">
                        <div className="w-full max-w-sm bg-white rounded-3xl shadow-2xl border border-gray-100 p-8 text-center">
                            <div className="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-6">
                                <AlertTriangle className="text-red-500" size={32} />
                            </div>
                            <h2 className="text-xl font-black text-gray-900 mb-4 uppercase tracking-wide">Aviso Importante<br/>de Saúde e Segurança</h2>
                            <div className="text-sm text-gray-600 space-y-4 text-justify leading-relaxed mb-8 max-h-60 overflow-y-auto pr-2 scrollbar-thin">
                                <p>
                                    Os treinos e exercícios pré-carregados neste aplicativo possuem caráter exclusivamente ilustrativo, servindo apenas para demonstrar as funcionalidades do sistema.
                                </p>
                                <p>
                                    O desenvolvedor deste aplicativo não é um profissional de educação física ou da área da saúde. O conteúdo aqui presente não substitui, em hipótese alguma, a orientação e prescrição de um Profissional de Educação Física habilitado.
                                </p>
                                <p>
                                    Antes de iniciar qualquer atividade física, consulte um profissional para avaliar suas condições físicas e prescrever um treino adequado aos seus objetivos e limitações. A prática de exercícios sem orientação pode resultar em lesões graves.
                                </p>
                            </div>
                            <div className="flex flex-col gap-3">
                                <button onClick={() => setView('login')} className="w-full bg-black text-white p-4 rounded-2xl font-bold text-lg hover:scale-[1.02] active:scale-95 transition-all shadow-lg">Concordo</button>
                                <button onClick={() => setView('goodbye')} className="w-full bg-gray-100 text-gray-500 p-4 rounded-2xl font-bold text-lg hover:bg-gray-200 transition-all">Sair</button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'goodbye') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-gray-50 animate-fade-in">
                        <div className="text-center">
                            <h1 className="text-2xl font-bold text-gray-400 mb-2">Aplicação Encerrada</h1>
                            <button onClick={() => setView('disclaimer')} className="mt-8 text-blue-500 font-bold text-sm underline">Voltar ao início</button>
                        </div>
                    </div>
                );
            }

            if (view === 'login') {
                return (
                    <div className="min-h-screen flex flex-col items-center justify-center p-6 bg-white animate-fade-in">
                        <div className="w-16 h-16 bg-black rounded-2xl flex items-center justify-center mb-6 shadow-xl">
                            <Dumbbell className="text-white" size={32} />
                        </div>
                        <h1 className="text-3xl font-black mb-2 tracking-tight text-center">Gym</h1>
                        <p className="text-gray-500 mb-8 text-center max-w-xs">Monte seu perfil para gerar o treino ideal.</p>
                        
                        <div className="w-full max-w-sm space-y-6">
                            <div>
                                <label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block">Seu Nome</label>
                                <input type="text" value={newUserName} onChange={(e) => setNewUserName(e.target.value)} placeholder="Ex: João Silva" className="w-full p-4 rounded-2xl bg-gray-100 text-lg font-medium outline-none focus:ring-2 focus:ring-black transition-all" />
                            </div>
                            <div>
                                <label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block">Gênero</label>
                                <div className="grid grid-cols-2 gap-3">
                                    <button onClick={() => setNewUserGender('male')} className={`p-4 rounded-2xl font-bold transition-all ${newUserGender === 'male' ? 'bg-black text-white shadow-lg' : 'bg-gray-100 text-gray-400'}`}>Homem</button>
                                    <button onClick={() => setNewUserGender('female')} className={`p-4 rounded-2xl font-bold transition-all ${newUserGender === 'female' ? 'bg-black text-white shadow-lg' : 'bg-gray-100 text-gray-400'}`}>Mulher</button>
                                </div>
                            </div>
                            <div>
                                <label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-2 block">Nível de Experiência</label>
                                <div className="space-y-2">
                                    <button onClick={() => setNewUserLevel('beginner')} className={`w-full p-4 rounded-2xl font-bold text-left transition-all flex justify-between items-center ${newUserLevel === 'beginner' ? 'bg-black text-white shadow-lg' : 'bg-gray-100 text-gray-400'}`}><span>Iniciante</span>{newUserLevel === 'beginner' && <Check size={18} />}</button>
                                    <button onClick={() => setNewUserLevel('intermediate')} className={`w-full p-4 rounded-2xl font-bold text-left transition-all flex justify-between items-center ${newUserLevel === 'intermediate' ? 'bg-black text-white shadow-lg' : 'bg-gray-100 text-gray-400'}`}><span>Intermediário</span>{newUserLevel === 'intermediate' && <Check size={18} />}</button>
                                    <button onClick={() => setNewUserLevel('advanced')} className={`w-full p-4 rounded-2xl font-bold text-left transition-all flex justify-between items-center ${newUserLevel === 'advanced' ? 'bg-black text-white shadow-lg' : 'bg-gray-100 text-gray-400'}`}><span>Avançado</span>{newUserLevel === 'advanced' && <Check size={18} />}</button>
                                </div>
                            </div>
                            <button onClick={handleLogin} className="w-full bg-black text-white p-4 rounded-2xl font-bold text-lg hover:scale-[1.02] active:scale-95 transition-all shadow-lg mt-4">Gerar Treino</button>
                        </div>
                    </div>
                );
            }

            if (view === 'dashboard') {
                const today = new Date();
                const currentDay = today.getDay(); 
                const diffToMonday = today.getDate() - currentDay + (currentDay === 0 ? -6 : 1);
                
                const monday = new Date(today);
                monday.setDate(diffToMonday);
                
                const weekDays = [];
                for (let i = 0; i < 7; i++) {
                    const d = new Date(monday);
                    d.setDate(monday.getDate() + i);
                    weekDays.push(d);
                }

                const sunday = new Date(monday);
                sunday.setDate(monday.getDate() + 6);

                const weekRange = `${monday.toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit'})} - ${sunday.toLocaleDateString('pt-BR', {day: '2-digit', month: '2-digit'})}`;

                // Count workouts this week
                const workoutsThisWeek = weekDays.filter(d => user.history.find(h => h.date === d.toLocaleDateString('pt-BR'))).length;

                const workoutKeys = Object.keys(user.workouts);
                return (
                    <div className="max-w-lg mx-auto min-h-screen pb-24 animate-fade-in relative">
                        <header className="p-6 pt-10 flex justify-between items-end bg-white border-b border-gray-100 sticky top-0 z-10 shadow-sm/50">
                            <div>
                                <p className="text-gray-500 font-medium text-sm">Bem-vindo(a) de volta,</p>
                                <h2 className="text-3xl font-black tracking-tight text-gray-900">{user.name}</h2>
                            </div>
                            <button onClick={() => { if(confirm("Deseja sair e trocar de usuário?")) { setUser(null); setView('disclaimer'); } }} className="w-12 h-12 rounded-full bg-gray-100 border border-gray-200 flex items-center justify-center text-xl font-bold text-gray-700 hover:bg-gray-200 transition-colors" title="Trocar Usuário">{user.name.charAt(0).toUpperCase()}</button>
                        </header>
                        <main className="p-6 space-y-8">
                            <div className="bg-orange-50 rounded-2xl p-4 border border-orange-100 flex items-center gap-4">
                                <div className="bg-orange-100 p-2 rounded-xl text-orange-600"><Trophy size={20} /></div>
                                <div><h4 className="text-sm font-bold text-orange-900">Ciclo de Adaptação</h4><p className="text-xs text-orange-700 mt-0.5">Troque o treino em <b>{getDaysRemaining()} dias</b>.</p></div>
                                <div className="ml-auto text-xs font-bold bg-white px-2 py-1 rounded-md text-orange-600 border border-orange-200 shadow-sm">{user.history.length}/60</div>
                            </div>
                            <section>
                                <div className="flex items-center gap-2 mb-3"><div className="h-2 w-2 rounded-full bg-black"></div><h3 className="font-bold text-lg">Sugestão de Hoje</h3></div>
                                <button onClick={() => startWorkout(suggested)} className="w-full bg-black text-white p-6 rounded-[32px] shadow-xl hover:shadow-2xl transition-all active:scale-[0.98] group relative overflow-hidden">
                                    <div className="absolute top-0 right-0 p-8 opacity-10"><Dumbbell size={100} /></div>
                                    <div className="relative z-10 flex justify-between items-center">
                                        <div className="text-left"><span className="bg-white/20 px-3 py-1 rounded-full text-xs font-bold uppercase tracking-wider backdrop-blur-sm">Recomendado</span><h2 className="text-4xl font-black mt-2 italic">TREINO {suggested}</h2><p className="text-white/60 text-sm mt-1 font-medium">{user.workouts[suggested]?.length || 0} exercícios</p></div>
                                        <div className="bg-white text-black h-12 w-12 rounded-full flex items-center justify-center group-hover:translate-x-1 transition-transform"><ArrowRight size={24} /></div>
                                    </div>
                                </button>
                            </section>
                            <section>
                                <div className="flex items-center gap-2 mb-3"><div className="h-2 w-2 rounded-full bg-gray-300"></div><h3 className="font-bold text-lg text-gray-500">Todos os Treinos</h3></div>
                                <div className="grid grid-cols-2 gap-4">
                                    {workoutKeys.map(type => (
                                        <div key={type} className="relative group">
                                            <button onClick={() => startWorkout(type)} className={`w-full p-5 rounded-[24px] text-left border-2 transition-all hover:border-black ${suggested === type ? 'border-gray-300 bg-gray-50 opacity-50' : 'bg-white border-transparent shadow-sm'}`}>
                                                <div className="flex justify-between items-start mb-4"><span className="text-2xl font-black text-gray-900 italic">{type}</span>{suggested === type && <div className="h-2 w-2 bg-black rounded-full"></div>}</div>
                                                <div className="text-xs font-bold text-gray-400 uppercase tracking-wider group-hover:text-gray-600">{user.workouts[type].length} Exercícios</div>
                                            </button>
                                            <button onClick={(e) => { e.stopPropagation(); goToEditMode(type); }} className="absolute top-3 right-3 p-2 bg-gray-100 rounded-full hover:bg-gray-200 text-gray-500 hover:text-black transition-colors z-10 shadow-sm" title="Editar Treino"><Settings size={16} /></button>
                                        </div>
                                    ))}
                                </div>
                            </section>
                            <section className="bg-white rounded-[24px] p-5 shadow-sm border border-gray-100">
                                <div className="flex justify-between items-center mb-4">
                                    <div className="flex items-center gap-2">
                                        <Calendar size={18} className="text-blue-500" />
                                        <div>
                                            <h3 className="font-bold text-gray-900 leading-none">Esta Semana</h3>
                                            <p className="text-[10px] text-gray-400 font-medium mt-0.5">{weekRange}</p>
                                        </div>
                                    </div>
                                    <div className="bg-blue-50 text-blue-700 px-2 py-1 rounded-lg text-xs font-bold">
                                        {workoutsThisWeek} treinos
                                    </div>
                                </div>
                                <div className="flex justify-between items-end">
                                    {weekDays.map((d, i) => {
                                        const dateStr = d.toLocaleDateString('pt-BR');
                                        const workoutDone = user.history.find(h => h.date === dateStr);
                                        const weekDay = d.toLocaleDateString('pt-BR', { weekday: 'short' }).slice(0, 1).toUpperCase();
                                        const isFuture = d > new Date(); 
                                        
                                        return (
                                            <div key={i} className={`flex flex-col items-center gap-2 ${isFuture ? 'opacity-30' : ''}`}>
                                                <div className={`w-8 h-8 rounded-full flex items-center justify-center text-xs font-bold transition-all ${workoutDone ? 'bg-green-500 text-white shadow-md scale-110' : 'bg-gray-100 text-gray-300'}`}>
                                                    {workoutDone ? workoutDone.type : ''}
                                                </div>
                                                <span className={`text-[10px] font-bold ${workoutDone ? 'text-black' : 'text-gray-300'}`}>{weekDay}</span>
                                            </div>
                                        )
                                    })}
                                </div>
                            </section>
                        </main>
                    </div>
                );
            }

            if (view === 'edit_workout') {
                return (
                    <div className="max-w-lg mx-auto min-h-screen bg-gray-50 pb-32 animate-fade-in relative">
                         <div className="bg-white sticky top-0 z-20 px-6 py-4 shadow-sm border-b border-gray-100 flex items-center justify-between">
                            <button onClick={cancelWorkoutChanges} className="p-2 -ml-2 hover:bg-gray-100 rounded-full transition-colors"><ChevronLeft size={24} /></button>
                            <h2 className="text-xl font-black italic tracking-tight">EDITAR TREINO {currentWorkout}</h2>
                            <div className="w-10"></div>
                        </div>
                        <main className="p-6 space-y-3">
                            <div className="bg-blue-50 text-blue-800 text-xs font-bold p-3 rounded-xl text-center mb-4">
                                Dica: Use as setas para reordenar. Deslize para a esquerda para excluir.
                            </div>
                            {tempWorkoutList.map((ex, idx) => (
                                <DraggableListItem 
                                    key={ex.id || idx} 
                                    index={idx}
                                    totalItems={tempWorkoutList.length}
                                    onDelete={() => removeExerciseFromTemp(idx)}
                                    onDragStart={onDragStart}
                                    onDragOver={onDragOver}
                                    onDrop={onDropTemp}
                                    onMoveUp={moveUp}
                                    onMoveDown={moveDown}
                                >
                                    <div className="flex items-center gap-4">
                                        <div className="w-10 h-10 bg-gray-100 rounded-xl flex items-center justify-center text-gray-500 font-bold">{idx + 1}</div>
                                        <div>
                                            <h4 className="font-bold text-gray-900 leading-tight">{ex.name}</h4>
                                            <p className="text-xs text-gray-500 mt-0.5">{ex.reps} • {ex.load}kg</p>
                                        </div>
                                    </div>
                                </DraggableListItem>
                            ))}
                            <button onClick={() => { setShowAddModal(true); setIsCustomExercise(false); }} className="w-full py-4 border-2 border-dashed border-gray-300 rounded-2xl text-gray-400 font-bold hover:border-black hover:text-black transition-all flex items-center justify-center gap-2 mt-4"><Plus size={20} /> Adicionar Exercício</button>
                        </main>
                        
                        <div className="fixed bottom-0 left-0 right-0 p-6 bg-white border-t flex gap-3 max-w-lg mx-auto">
                            <button onClick={cancelWorkoutChanges} className="flex-1 py-4 font-bold text-gray-500 bg-gray-100 rounded-2xl hover:bg-gray-200 transition-all">Cancelar</button>
                            <button onClick={saveWorkoutChanges} className="flex-1 py-4 font-bold text-white bg-green-500 rounded-2xl hover:bg-green-600 transition-all">Salvar</button>
                        </div>

                         {/* Add Exercise Modal */}
                         {showAddModal && (
                            <div className="fixed inset-0 z-50 flex items-end justify-center bg-black/60 backdrop-blur-sm animate-fade-in">
                                <div className="bg-white w-full max-w-lg rounded-t-[32px] p-8 animate-slide-up h-[85vh] overflow-y-auto no-scrollbar">
                                    <div className="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
                                    <h3 className="text-xl font-bold mb-6 text-gray-900">Novo Exercício</h3>
                                    <form onSubmit={(e) => {
                                        e.preventDefault();
                                        addExerciseToTemp({
                                            name: e.target.name.value,
                                            sets: e.target.sets ? e.target.sets.value : '',
                                            reps: e.target.reps.value,
                                            load: e.target.load.value,
                                            rest: e.target.rest ? e.target.rest.value : '0',
                                            img: e.target.img ? e.target.img.value : ''
                                        });
                                    }} className="space-y-4">
                                        <div>
                                            <label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">Nome do Exercício</label>
                                            {!isCustomExercise ? (
                                                <select name="name" required className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none appearance-none" onChange={(e) => { 
                                                    if (e.target.value === 'custom') { 
                                                        setIsCustomExercise(true); 
                                                        e.target.value = ''; 
                                                        setIsCardioSelected(false);
                                                    } else {
                                                        const cardio = isCardioExercise(e.target.value);
                                                        setIsCardioSelected(cardio);
                                                        
                                                        // Auto-fill logic
                                                        if (!cardio) {
                                                            const autoImg = getFileName(e.target.value);
                                                            const imgInput = document.querySelector('input[name="img"]');
                                                            if(imgInput) imgInput.value = autoImg;
                                                        } else {
                                                            // Clear image field if cardio
                                                            const imgInput = document.querySelector('input[name="img"]');
                                                            if(imgInput) imgInput.value = "";
                                                        }
                                                    } 
                                                }}>
                                                    <option value="" disabled selected>Selecione da lista...</option>
                                                    {BASIC_EXERCISES_LIST.map(ex => <option key={ex} value={ex}>{ex}</option>)}
                                                    <option value="custom" className="font-bold text-blue-600">+ Criar outro exercício...</option>
                                                </select>
                                            ) : (
                                                <div className="flex gap-2"><input name="name" required autoFocus className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none" placeholder="Digite o nome..." /><button type="button" onClick={() => setIsCustomExercise(false)} className="px-4 bg-gray-200 rounded-xl font-bold text-gray-500 text-xs hover:bg-gray-300">Voltar</button></div>
                                            )}
                                        </div>
                                        
                                        {!isCardioSelected && (
                                            <div className="grid grid-cols-2 gap-4">
                                                <div><label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">Séries</label><input name="sets" type="number" inputMode="numeric" required className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none" placeholder="3" /></div>
                                                <div><label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">Repetições</label><input name="reps" type="number" inputMode="numeric" required className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none" placeholder="12" /></div>
                                            </div>
                                        )}

                                        {isCardioSelected && (
                                            <div>
                                                <label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">Tempo (min)</label>
                                                <input name="reps" type="number" inputMode="numeric" required className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none" placeholder="20" />
                                            </div>
                                        )}

                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">{isCardioSelected ? 'Nível/Carga' : 'Carga (kg)'}</label>
                                                <input name="load" type="number" inputMode="numeric" required className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none" placeholder="10" />
                                            </div>
                                            
                                            {!isCardioSelected && (
                                                <div><label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">Descanso (seg)</label><input name="rest" type="number" inputMode="numeric" required className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none" placeholder="60" /></div>
                                            )}
                                        </div>

                                        {!isCardioSelected && (
                                            <div><label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">Imagem (Opcional)</label><input name="img" className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none" placeholder="URL da foto" /></div>
                                        )}

                                        <div className="pt-4 flex gap-3"><button type="button" onClick={() => setShowAddModal(false)} className="flex-1 py-4 font-bold text-gray-500 bg-gray-100 rounded-2xl">Cancelar</button><button type="submit" className="flex-1 py-4 font-bold text-white bg-black rounded-2xl">Adicionar</button></div>
                                    </form>
                                </div>
                            </div>
                        )}

                        {/* Edit Exercise Modal (From Workout Screen) */}
                        {editingIndex !== null && (
                            <div className="fixed inset-0 z-50 flex items-end justify-center bg-black/60 backdrop-blur-sm animate-fade-in">
                                <div className="bg-white w-full max-w-lg rounded-t-[32px] p-8 animate-slide-up">
                                    <div className="w-12 h-1.5 bg-gray-200 rounded-full mx-auto mb-6"></div>
                                    <h3 className="text-xl font-bold mb-6 text-gray-900">Editar {user.workouts[currentWorkout][editingIndex].name}</h3>
                                    
                                    {(() => {
                                        const isCardio = isCardioExercise(user.workouts[currentWorkout][editingIndex].name);
                                        return (
                                            <div className="space-y-4">
                                                {!isCardio ? (
                                                    <div className="flex gap-4">
                                                        <div className="flex-1">
                                                            <label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">Séries</label>
                                                            <input id="editSets" type="number" inputMode="numeric" defaultValue={editRepsSets} className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none" />
                                                        </div>
                                                        <div className="flex-1">
                                                            <label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">Repetições</label>
                                                            <input id="editReps" type="number" inputMode="numeric" defaultValue={editRepsCount} className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none" />
                                                        </div>
                                                    </div>
                                                ) : (
                                                    <div>
                                                        <label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">Tempo (min)</label>
                                                        <input id="editReps" type="number" inputMode="numeric" defaultValue={editRepsCount} className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none" />
                                                        {/* Hidden inputs for saveEdit to grab */}
                                                        <input id="editSets" type="hidden" value="" />
                                                    </div>
                                                )}

                                                <div>
                                                    <label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">{isCardio ? 'Nível/Carga' : 'Carga (kg)'}</label>
                                                    <input id="editLoad" type="number" inputMode="numeric" defaultValue={user.workouts[currentWorkout][editingIndex].load} className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none" />
                                                </div>

                                                {!isCardio ? (
                                                    <div>
                                                        <label className="text-xs font-bold text-gray-500 uppercase tracking-wider mb-1 block">Descanso (s)</label>
                                                        <input id="editRest" type="number" inputMode="numeric" defaultValue={user.workouts[currentWorkout][editingIndex].rest} className="w-full bg-gray-100 p-4 rounded-xl font-bold text-gray-900 focus:ring-2 focus:ring-black outline-none" />
                                                    </div>
                                                ) : (
                                                    <input id="editRest" type="hidden" value="0" />
                                                )}
                                            </div>
                                        );
                                    })()}

                                    <div className="flex gap-3 mt-8">
                                        <button onClick={() => setEditingIndex(null)} className="flex-1 py-4 font-bold text-gray-500 bg-gray-100 rounded-2xl">Cancelar</button>
                                        <button 
                                            onClick={() => saveEdit(
                                                document.getElementById('editSets').value,
                                                document.getElementById('editReps').value,
                                                document.getElementById('editLoad').value,
                                                document.getElementById('editRest').value
                                            )}
                                            className="flex-1 py-4 font-bold text-white bg-black rounded-2xl"
                                        >
                                            Salvar
                                        </button>
                                    </div>
                                </div>
                            </div>
                        )}
                    </div>
                );
            }

            return null;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<FlexLogApp />);
    </script>
</body>
</html>
